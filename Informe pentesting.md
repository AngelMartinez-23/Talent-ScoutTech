# Introducción

Este informe detalla los hallazgos y vulnerabilidades detectadas durante la evaluación de seguridad realizada sobre la aplicación. Se describen las pruebas de penetración llevadas a cabo, los vectores de ataque explotados y las vulnerabilidades identificadas, así como las propuestas de solución para mitigar los riesgos asociados. Las principales vulnerabilidades encontradas incluyen Inyección SQL (SQLi), Cross-Site Scripting (XSS) y problemas relacionados con la implementación de seguridad en el manejo de sesiones y formularios.

<br>
<br>

# **Inyección SQL (SQLi)**

## **Identificación de un error por inyección SQL en el login**

Durante las pruebas realizadas en el formulario de inicio de sesión, se detectó que el campo de entrada destinado al nombre de usuario permite realizar inyecciones SQL. Esto quedó en evidencia al introducir caracteres especiales, como comillas dobles (`"`) en el campo, lo que provocó que la aplicación devolviera un mensaje de error exponiendo la consulta SQL.

**Ejemplo del error generado:** 

![Imagen 1](/imagen/Imagen1.png)

El error reveló que los datos introducidos por el usuario se integran directamente en la consulta SQL sin validarse ni escapar correctamente, lo que permite a un atacante manipular la consulta para acceder a información sensible.

**Consulta expuesta en el mensaje de error:**

![Imagen 2](/imagen/Imagen2.png)

<br>

## **Explotación de la vulnerabilidad SQL para suplantar usuarios**

Se aprovechó la vulnerabilidad detectada para realizar un ataque de suplantación de usuario. Utilizando el campo de usuario susceptible a inyección SQL, se intentaron diversas combinaciones de contraseñas manualmente. Dado que solo había seis contraseñas posibles, se probó cada una de ellas directamente en el formulario de inicio de sesión, manipulando el campo de usuario para inyectar una consulta SQL que permitiera omitir la validación de la contraseña.

**Payload utilizado en la inyección SQL:** 

![Imagen 3](/imagen/Imagen3.png)

Con las credenciales obtenidas, se verificó que el usuario podía iniciar sesión correctamente:

![Imagen 4](/imagen/imagen4.png)

Tras iniciar sesión con las credenciales obtenidas a través de la inyección SQL, se accedió a la sección de comentarios de la aplicación. Al agregar un comentario relacionado con uno de los jugadores, y posteriormente visualizarlo.

**Imagen mostrando el proceso de agregar un comentario:**

![Imagen 5](/imagen/Imagen5.png)

En la imagen anterior, se puede ver cómo se agrega un comentario. Al mostrar el comentario agregado, se revela el nombre de usuario de la persona que lo introdujo, confirmando que el sistema permite ver dicha información.

**Imagen que muestra el nombre de usuario reflejado junto al comentario:**

![Imagen 6](/imagen/Imagen6.png)

<br>

## **Propuesta de solución para evitar la inyección SQL**

Al analizar el archivo `auth.php`, se identificó que la función `areUserAndPasswordValid()` realiza la validación de las credenciales, pero utiliza `SQLite3::escapeString()` para sanitizar la entrada de los usuarios. Aunque esta función ayuda a gestionar algunos caracteres especiales, no es suficiente para proteger completamente la consulta contra inyecciones SQL. Al depender de este método, la aplicación sigue siendo vulnerable a manipulaciones que permiten a un atacante modificar la consulta SQL y acceder a datos sensibles.

**Fragmento de código vulnerable:**

```php
$sql = "SELECT userId FROM users WHERE username = '" . $username . "' AND password = '" . $password . "'";
```

<br>
<br>

# **Cross-Site Scripting (XSS)**

## **Prueba de vulnerabilidad XSS con script en comentarios**

Se llevó a cabo una prueba para determinar si la aplicación es susceptible a ataques de Cross-Site Scripting (XSS). Para ello, se accedió a la sección de comentarios del jugador con ID 5, ubicada en la URL [http://localhost:8080/add_comment.php?id=5](http://localhost:8080/add_comment.php?id=5). En esta página, es posible dejar un comentario asociado a dicho jugador.

![Imagen 8](/imagen/Imagen8.png)

Para probar la vulnerabilidad, se introdujo un comentario que contenía un fragmento de código JavaScript diseñado para ejecutar una alerta al ser mostrado.

**Resultado de la prueba de inyección de XSS:**

![Imagen 9](/imagen/Imagen9.png)

<br>

## **Identificación de otras páginas afectadas por XSS y análisis**

Además de la página "show_comments.php", otras páginas también se encuentran afectadas por la vulnerabilidad XSS debido a que no se escapan adecuadamente las entradas de los usuarios. Al insertar comentarios o interactuar con estas páginas, es posible inyectar código JavaScript, lo que permite la ejecución de scripts maliciosos cuando se visualizan las páginas afectadas.

**Páginas afectadas:**
- `add_comment.php`
- `show_comments.php`

**Análisis:**

Al revisar el código de estas páginas, se observó que no se validan ni escapan correctamente los datos introducidos por los usuarios, lo que genera un entorno vulnerable a ataques de tipo XSS. Esto significa que al insertar un comentario en cualquiera de los formularios, los scripts pueden ejecutarse al mostrar los comentarios en la página de listado, comprometiendo la seguridad de los usuarios.

Para mitigar esta vulnerabilidad, es crucial implementar técnicas de escape, como `htmlspecialchars()`, en todas las páginas que muestran datos proporcionados por el usuario.


<br>
<br>

# **Gestión de botones y enlaces en la interfaz**

## **Edición de Jugador**

Durante las pruebas, se observó que es posible modificar la interfaz de usuario para incluir un botón "Profile" debajo del nombre del equipo al editar un jugador. Este botón debería redirigir a la página correspondiente para la gestión del perfil y la transferencia del jugador. A continuación se muestra un ejemplo de cómo implementar dicho botón.

![Imagen 10](/imagen/Imagen10.png)

![Imagen 11](/imagen/Imagen11.png)

![Imagen 12](/imagen/Imagen12.png)

Este botón "Profile" proporcionaría un enlace directo a la página que gestiona la transferencia del jugador.

<br>

## **Enlace en Comentarios**

Además, se identificó que para agregar enlaces correctamente en los comentarios, es necesario utilizar la función `fetch()` para acceder a los datos y presentarlos adecuadamente en la interfaz de usuario. A continuación, se muestra un ejemplo de cómo implementar esta función en el sistema.

![Imagen 13](/imagen/Imagen13.png)

<br>
<br>

# **Conclusiones**

Durante las pruebas se identificaron vulnerabilidades críticas, como la **inyección SQL (SQLi)** y el **Cross-Site Scripting (XSS)**, debido a la falta de validación y escape adecuado de los datos de entrada, lo que permite a un atacante manipular consultas SQL y ejecutar scripts maliciosos. Además, la gestión de botones y enlaces en la interfaz de usuario requiere mejoras para garantizar un comportamiento seguro. Para mitigar estos riesgos, es fundamental implementar sentencias preparadas, técnicas de escape como `htmlspecialchars()` y mejorar la validación en la interfaz de usuario.

